###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         03/May/2014  09:19:33 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Compone #
#                          nts\stack\sys\ZGlobals.c                           #
#    Command line       =  -f F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3. #
#                          ÏîÄ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Proj #
#                          ects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC253 #
#                          0DB\..\..\..\Tools\CC2530DB\f8wCoord.cfg           #
#                          (-DCPU32MHZ -DROOT=__near_func                     #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS) -f       #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \..\..\..\Tools\CC2530DB\f8wConfig.cfg             #
#                          (-DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR      #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFF0                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Compone #
#                          nts\stack\sys\ZGlobals.c -D ZIGBEEPRO -D ZTOOL_P1  #
#                          -D MT_TASK -D MT_SYS_FUNC -D xMT_ZDO_FUNC -D       #
#                          LCD_SUPPORTED=DEBUG -D NV_RESTORE -lC              #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \CoordinatorEB\List\ -lA                           #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \CoordinatorEB\List\ --diag_suppress Pe001,Pa010   #
#                          -o F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3. #
#                          ÏîÄ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Proj #
#                          ects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC253 #
#                          0DB\CoordinatorEB\Obj\ -e --debug --core=plain     #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\À #
#                          ý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô #
#                          ×éÍøÓëÊý¾Ý´«Êä£©\Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ #
#                          ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB\ -I                       #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \..\SOURCE\ -I F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3 #
#                          .ÏîÄ¿Êµ¼ù\3.ÏîÄ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾ #
#                          Ý´«Êä£©\Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô #
#                          ×éÍø£©\CC2530DB\..\..\..\ZMAIN\TI2530DB\ -I        #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \..\..\..\..\..\COMPONENTS\MT\ -I                  #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \..\..\..\..\..\COMPONENTS\HAL\INCLUDE\ -I         #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \..\..\..\..\..\COMPONENTS\HAL\TARGET\CC2530EB\    #
#                          -I F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3. #
#                          ÏîÄ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Proj #
#                          ects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\OSAL\MCU\CCSOC\ -I   #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \..\..\..\..\..\COMPONENTS\OSAL\INCLUDE\ -I        #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \..\..\..\..\..\COMPONENTS\STACK\AF\ -I            #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \..\..\..\..\..\COMPONENTS\STACK\NWK\ -I           #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \..\..\..\..\..\COMPONENTS\STACK\SEC\ -I           #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \..\..\..\..\..\COMPONENTS\STACK\SAPI\ -I          #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \..\..\..\..\..\COMPONENTS\STACK\SYS\ -I           #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \..\..\..\..\..\COMPONENTS\STACK\ZDO\ -I           #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \..\..\..\..\..\COMPONENTS\ZMAC\F8W\ -I            #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \..\..\..\..\..\COMPONENTS\ZMAC\ -I                #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \..\..\..\..\..\COMPONENTS\SERVICES\SADDR\ -I      #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \..\..\..\..\..\COMPONENTS\SERVICES\SDATA\ -I      #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \..\..\..\..\..\COMPONENTS\MAC\INCLUDE\ -I         #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \..\..\..\..\..\COMPONENTS\MAC\HIGH_LEVEL\ -I      #
#                          F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL\srf04\    #
#                          -I F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3. #
#                          ÏîÄ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Proj #
#                          ects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC253 #
#                          0DB\..\..\..\..\..\COMPONENTS\MAC\LOW_LEVEL\srf04\ #
#                          SINGLE_CHIP\ -Ohz --require_prototypes             #
#    List file          =  F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \CoordinatorEB\List\ZGlobals.lst                   #
#    Object file        =  F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ #
#                          ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Project #
#                          s\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB #
#                          \CoordinatorEB\Obj\ZGlobals.r51                    #
#                                                                             #
#                                                                             #
###############################################################################

F:\Ò×Ë¼CC2530_1B×ÊÁÏ¹âÅÌ\Àý³ÌÔ´Âë\3.ÏîÄ¿Êµ¼ù\3.ÏîÄ¿Êµ¼ù\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Components\stack\sys\ZGlobals.c
      1          /**************************************************************************************************
      2            Filename:       ZGlobals.c
      3            Revised:        $Date: 2010-01-17 08:58:03 -0800 (Sun, 17 Jan 2010) $
      4            Revision:       $Revision: 21533 $
      5          
      6            Description:    User definable Z-Stack parameters.
      7          
      8          
      9            Copyright 2007-2010 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41           * INCLUDES
     42           */
     43          
     44          #include "ZComDef.h"
     45          #include "OSAL_Nv.h"
     46          #include "ZDObject.h"
     47          #include "ZGlobals.h"
     48          #include "ZDNwkMgr.h"
     49          
     50          #if defined(ZCL_KEY_ESTABLISH)
     51          #include "zcl_key_establish.h"
     52          #endif
     53          
     54          #include "OnBoard.h"
     55          
     56          /*********************************************************************
     57           * MACROS
     58           */
     59          
     60          /*********************************************************************
     61           * CONSTANTS
     62           */
     63          
     64          /*********************************************************************
     65           * TYPEDEFS
     66           */
     67          
     68          typedef struct zgItem
     69          {
     70            uint16 id;
     71            uint16 len;
     72            void *buf;
     73          } zgItem_t;
     74          
     75          /*********************************************************************
     76           * NWK GLOBAL VARIABLES
     77           */
     78          
     79          // Polling values

   \                                 In  segment XDATA_I, align 1, keep-with-next
     80          uint16 zgPollRate = POLL_RATE;
   \                     zgPollRate:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for zgPollRate>`
   \   000002                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
     81          uint16 zgQueuedPollRate = QUEUED_POLL_RATE;
   \                     zgQueuedPollRate:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for zgQueuedPollRate>`
   \   000002                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
     82          uint16 zgResponsePollRate = RESPONSE_POLL_RATE;
   \                     zgResponsePollRate:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for zgResponsePollRate>`
   \   000002                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
     83          uint16 zgRejoinPollRate = REJOIN_POLL_RATE;
   \                     zgRejoinPollRate:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for zgRejoinPollRate>`
   \   000002                REQUIRE __INIT_XDATA_I
     84          
     85          // Transmission retries numbers

   \                                 In  segment XDATA_I, align 1, keep-with-next
     86          uint8 zgMaxDataRetries = NWK_MAX_DATA_RETRIES;
   \                     zgMaxDataRetries:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgMaxDataRetries>`
   \   000001                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
     87          uint8 zgMaxPollFailureRetries = MAX_POLL_FAILURE_RETRIES;
   \                     zgMaxPollFailureRetries:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgMaxPollFailureRetries>`
   \   000001                REQUIRE __INIT_XDATA_I
     88          
     89          // Default channel list

   \                                 In  segment XDATA_I, align 1, keep-with-next
     90          uint32 zgDefaultChannelList = DEFAULT_CHANLIST;
   \                     zgDefaultChannelList:
   \   000000                DS 4
   \   000004                REQUIRE `?<Initializer for zgDefaultChannelList>`
   \   000004                REQUIRE __INIT_XDATA_I
     91          
     92          // Default starting scan duration

   \                                 In  segment XDATA_I, align 1, keep-with-next
     93          uint8 zgDefaultStartingScanDuration = STARTING_SCAN_DURATION;
   \                     zgDefaultStartingScanDuration:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgDefaultStartingScanDuratio`
   \   000001                REQUIRE __INIT_XDATA_I
     94          
     95          // Stack profile Id

   \                                 In  segment XDATA_I, align 1, keep-with-next
     96          uint8 zgStackProfile = STACK_PROFILE_ID;
   \                     zgStackProfile:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgStackProfile>`
   \   000001                REQUIRE __INIT_XDATA_I
     97          
     98          // Default indirect message holding timeout

   \                                 In  segment XDATA_I, align 1, keep-with-next
     99          uint8 zgIndirectMsgTimeout = NWK_INDIRECT_MSG_TIMEOUT;
   \                     zgIndirectMsgTimeout:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgIndirectMsgTimeout>`
   \   000001                REQUIRE __INIT_XDATA_I
    100          
    101          // Security mode

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    102          uint8 zgSecurityMode = ZG_SECURITY_MODE;
   \                     zgSecurityMode:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    103          
    104          // Secure permit join

   \                                 In  segment XDATA_I, align 1, keep-with-next
    105          uint8 zgSecurePermitJoin = true;
   \                     zgSecurePermitJoin:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgSecurePermitJoin>`
   \   000001                REQUIRE __INIT_XDATA_I
    106          
    107          // Trust center address

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    108          uint16 zgTrustCenterAddr = ZG_TRUSTCENTER_ADDR;
   \                     zgTrustCenterAddr:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    109          
    110          #if defined(ZCL_KEY_ESTABLISH)
    111          
    112          // 32 bits counter for random number generator
    113          uint32 zgRNGCounter = 1;
    114          
    115          // Certificate Authority Public Key
    116          uint8 zgCAPublicKey[ZCL_KEY_ESTABLISHMENT_PUBLIC_KEY_LENGTH];
    117          
    118          // Local Certificate for AMI CBKE
    119          uint8 zgLocalCertificate[ZCL_KEY_ESTABLISHMENT_CERTIFICATE_LENGTH];
    120          
    121          // Static Private Key
    122          uint8 zgStaticPrivateKey[ZCL_KEY_ESTABLSIHMENT_PRIVATE_KEY_LENTGH];
    123          
    124          // For test only
    125          uint8 zgRemotePublicKey[ZCL_KEY_ESTABLISHMENT_PUBLIC_KEY_LENGTH];
    126          #endif
    127          
    128          // Route expiry

   \                                 In  segment XDATA_I, align 1, keep-with-next
    129          uint8 zgRouteExpiryTime = ROUTE_EXPIRY_TIME;
   \                     zgRouteExpiryTime:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgRouteExpiryTime>`
   \   000001                REQUIRE __INIT_XDATA_I
    130          
    131          // Extended PAN Id

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    132          uint8 zgExtendedPANID[Z_EXTADDR_LEN];
   \                     zgExtendedPANID:
   \   000000                DS 8
   \   000008                REQUIRE __INIT_XDATA_Z
    133          
    134          // Broadcast parameters

   \                                 In  segment XDATA_I, align 1, keep-with-next
    135          uint8 zgMaxBcastRetires   = MAX_BCAST_RETRIES;
   \                     zgMaxBcastRetires:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgMaxBcastRetires>`
   \   000001                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
    136          uint8 zgPassiveAckTimeout = PASSIVE_ACK_TIMEOUT;
   \                     zgPassiveAckTimeout:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgPassiveAckTimeout>`
   \   000001                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_I, align 1, keep-with-next
    137          uint8 zgBcastDeliveryTime = BCAST_DELIVERY_TIME;
   \                     zgBcastDeliveryTime:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgBcastDeliveryTime>`
   \   000001                REQUIRE __INIT_XDATA_I
    138          
    139          // Network mode

   \                                 In  segment XDATA_I, align 1, keep-with-next
    140          uint8 zgNwkMode = NWK_MODE;
   \                     zgNwkMode:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgNwkMode>`
   \   000001                REQUIRE __INIT_XDATA_I
    141          
    142          // Many-to-one values

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    143          uint8 zgConcentratorEnable = CONCENTRATOR_ENABLE;
   \                     zgConcentratorEnable:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    144          uint8 zgConcentratorDiscoveryTime = CONCENTRATOR_DISCOVERY_TIME;
   \                     zgConcentratorDiscoveryTime:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_I, align 1, keep-with-next
    145          uint8 zgConcentratorRadius = CONCENTRATOR_RADIUS;
   \                     zgConcentratorRadius:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgConcentratorRadius>`
   \   000001                REQUIRE __INIT_XDATA_I

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    146          uint8 zgConcentratorRC = CONCENTRATOR_ROUTE_CACHE;   // concentrator with route cache (no memory constraints)
   \                     zgConcentratorRC:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    147          
    148          /*********************************************************************
    149           * APS GLOBAL VARIABLES
    150           */
    151          
    152          // The maximum number of retries allowed after a transmission failure

   \                                 In  segment XDATA_I, align 1, keep-with-next
    153          uint8 zgApscMaxFrameRetries = APSC_MAX_FRAME_RETRIES;
   \                     zgApscMaxFrameRetries:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgApscMaxFrameRetries>`
   \   000001                REQUIRE __INIT_XDATA_I
    154          
    155          // The maximum number of seconds (milliseconds) to wait for an
    156          // acknowledgement to a transmitted frame.
    157          
    158          // This number is used by polled devices.

   \                                 In  segment XDATA_I, align 1, keep-with-next
    159          uint16 zgApscAckWaitDurationPolled = APSC_ACK_WAIT_DURATION_POLLED;
   \                     zgApscAckWaitDurationPolled:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for zgApscAckWaitDurationPolled>`
   \   000002                REQUIRE __INIT_XDATA_I
    160          
    161          // This number is used by non-polled devices in the following formula:
    162          //   (100 mSec) * (_NIB.MaxDepth * zgApsAckWaitMultiplier)

   \                                 In  segment XDATA_I, align 1, keep-with-next
    163          uint8 zgApsAckWaitMultiplier = 2;
   \                     zgApsAckWaitMultiplier:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgApsAckWaitMultiplier>`
   \   000001                REQUIRE __INIT_XDATA_I
    164          
    165          // The maximum number of milliseconds for the end device binding

   \                                 In  segment XDATA_I, align 1, keep-with-next
    166          uint16 zgApsDefaultMaxBindingTime = APS_DEFAULT_MAXBINDING_TIME;
   \                     zgApsDefaultMaxBindingTime:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for zgApsDefaultMaxBindingTime>`
   \   000002                REQUIRE __INIT_XDATA_I
    167          
    168          // The 64-big identifier of the network to join or form.
    169          // Default set to all zeros

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    170          uint8 zgApsUseExtendedPANID[Z_EXTADDR_LEN] = {00,00,00,00,00,00,00,00};
   \                     zgApsUseExtendedPANID:
   \   000000                DS 8
   \   000008                REQUIRE __INIT_XDATA_Z
    171          
    172          // A boolean flag that indicates whether it is OK to use insecure join
    173          // on startup. Default set to true

   \                                 In  segment XDATA_I, align 1, keep-with-next
    174          uint8 zgApsUseInsecureJoin = TRUE;
   \                     zgApsUseInsecureJoin:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgApsUseInsecureJoin>`
   \   000001                REQUIRE __INIT_XDATA_I
    175          
    176          // The size of a tx window when using fragmentation

   \                                 In  segment XDATA_I, align 1, keep-with-next
    177          uint8 zgApscMaxWindowSize = APS_DEFAULT_WINDOW_SIZE;
   \                     zgApscMaxWindowSize:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgApscMaxWindowSize>`
   \   000001                REQUIRE __INIT_XDATA_I
    178          
    179          // The delay between tx packets when using fragmentaition

   \                                 In  segment XDATA_I, align 1, keep-with-next
    180          uint16 zgApsInterframeDelay = APS_DEFAULT_INTERFRAME_DELAY;
   \                     zgApsInterframeDelay:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for zgApsInterframeDelay>`
   \   000002                REQUIRE __INIT_XDATA_I
    181          
    182          // The radius of broadcast multicast transmissions

   \                                 In  segment XDATA_I, align 1, keep-with-next
    183          uint8 zgApsNonMemberRadius = APS_DEFAULT_NONMEMBER_RADIUS;
   \                     zgApsNonMemberRadius:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgApsNonMemberRadius>`
   \   000001                REQUIRE __INIT_XDATA_I
    184          /*********************************************************************
    185           * SECURITY GLOBAL VARIABLES
    186           */
    187          
    188          // This is the pre-configured key in use (from NV memory)

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    189          uint8 zgPreConfigKey[SEC_KEY_LEN];
   \                     zgPreConfigKey:
   \   000000                DS 16
   \   000010                REQUIRE __INIT_XDATA_Z
    190          
    191          // If true, preConfigKey should be configured on all devices on the network
    192          // If false, it is configured only on the coordinator and sent to other
    193          // devices upon joining.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    194          uint8 zgPreConfigKeys = FALSE;// TRUE;
   \                     zgPreConfigKeys:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    195          
    196          // If true, defaultTCLinkKey should be configured on all devices on the 
    197          // network. If false, individual trust center link key between each device and 
    198          // the trust center should be manually configured via MT_WRITE_NV

   \                                 In  segment XDATA_I, align 1, keep-with-next
    199          uint8 zgUseDefaultTCLK = TRUE; // FALSE
   \                     zgUseDefaultTCLK:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgUseDefaultTCLK>`
   \   000001                REQUIRE __INIT_XDATA_I
    200          
    201          
    202          /*********************************************************************
    203           * ZDO GLOBAL VARIABLES
    204           */
    205          
    206          // Configured PAN ID

   \                                 In  segment XDATA_I, align 1, keep-with-next
    207          uint16 zgConfigPANID = ZDAPP_CONFIG_PAN_ID;
   \                     zgConfigPANID:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for zgConfigPANID>`
   \   000002                REQUIRE __INIT_XDATA_I
    208          
    209          // Device Logical Type

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    210          uint8 zgDeviceLogicalType = DEVICE_LOGICAL_TYPE;
   \                     zgDeviceLogicalType:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    211          
    212          // Startup Delay

   \                                 In  segment XDATA_I, align 1, keep-with-next
    213          uint8 zgStartDelay = START_DELAY;
   \                     zgStartDelay:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgStartDelay>`
   \   000001                REQUIRE __INIT_XDATA_I
    214          
    215          #if !defined MT_TASK
    216          // Flag to use verbose (i.e. "cc2480-style") direct MT callbacks in ZDProfile.c, ZDP_IncomingData().
    217          uint8 zgZdoDirectCB = FALSE;
    218          #endif
    219          
    220          /*********************************************************************
    221           * APPLICATION GLOBAL VARIABLES
    222           */
    223          
    224          // Network Manager Mode

   \                                 In  segment XDATA_I, align 1, keep-with-next
    225          uint8 zgNwkMgrMode = ZDNWKMGR_ENABLE;
   \                     zgNwkMgrMode:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgNwkMgrMode>`
   \   000001                REQUIRE __INIT_XDATA_I
    226          
    227          /*********************************************************************
    228           * NON-STANDARD GLOBAL VARIABLES
    229           */
    230          
    231          // Simple API Endpoint

   \                                 In  segment XDATA_I, align 1, keep-with-next
    232          uint8 zgSapiEndpoint = SAPI_ENDPOINT;
   \                     zgSapiEndpoint:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zgSapiEndpoint>`
   \   000001                REQUIRE __INIT_XDATA_I
    233          
    234          /*********************************************************************
    235           * LOCAl VARIABLES
    236           */
    237          
    238          /*********************************************************************
    239           * ZGlobal Item Table
    240           */

   \                                 In  segment CODE_C, align 1
    241          static CONST zgItem_t zgItemTable[] =
   \                     zgItemTable:
   \   000000   0000         DW 0
   \   000002   0000         DW 0
   \   000004   0000         DW 0H
    242          {
    243          #if defined ( NV_INIT )
    244          #if !defined MT_TASK
    245            {
    246              ZCD_NV_ZDO_DIRECT_CB, sizeof(zgZdoDirectCB), &zgZdoDirectCB
    247            },
    248          #endif
    249            {
    250              ZCD_NV_LOGICAL_TYPE, sizeof(zgDeviceLogicalType), &zgDeviceLogicalType
    251            },
    252            {
    253              ZCD_NV_POLL_RATE, sizeof(zgPollRate), &zgPollRate
    254            },
    255            {
    256             ZCD_NV_QUEUED_POLL_RATE, sizeof(zgQueuedPollRate), &zgQueuedPollRate
    257            },
    258            {
    259              ZCD_NV_RESPONSE_POLL_RATE, sizeof(zgResponsePollRate), &zgResponsePollRate
    260            },
    261            {
    262              ZCD_NV_REJOIN_POLL_RATE, sizeof(zgRejoinPollRate), &zgRejoinPollRate
    263            },
    264            {
    265             ZCD_NV_DATA_RETRIES, sizeof(zgMaxDataRetries), &zgMaxDataRetries
    266            },
    267            {
    268               ZCD_NV_POLL_FAILURE_RETRIES, sizeof(zgMaxPollFailureRetries), &zgMaxPollFailureRetries
    269            },
    270            {
    271              ZCD_NV_CHANLIST, sizeof(zgDefaultChannelList), &zgDefaultChannelList
    272            },
    273            {
    274              ZCD_NV_SCAN_DURATION, sizeof(zgDefaultStartingScanDuration), &zgDefaultStartingScanDuration
    275            },
    276            {
    277              ZCD_NV_STACK_PROFILE, sizeof(zgStackProfile), &zgStackProfile
    278            },
    279            {
    280              ZCD_NV_INDIRECT_MSG_TIMEOUT, sizeof(zgIndirectMsgTimeout), &zgIndirectMsgTimeout
    281            },
    282            {
    283              ZCD_NV_ROUTE_EXPIRY_TIME, sizeof(zgRouteExpiryTime), &zgRouteExpiryTime
    284            },
    285            {
    286              ZCD_NV_EXTENDED_PAN_ID, Z_EXTADDR_LEN, zgExtendedPANID
    287            },
    288            {
    289              ZCD_NV_BCAST_RETRIES, sizeof(zgMaxBcastRetires), &zgMaxBcastRetires
    290            },
    291            {
    292              ZCD_NV_PASSIVE_ACK_TIMEOUT, sizeof(zgPassiveAckTimeout), &zgPassiveAckTimeout
    293            },
    294            {
    295              ZCD_NV_BCAST_DELIVERY_TIME, sizeof(zgBcastDeliveryTime), &zgBcastDeliveryTime
    296            },
    297            {
    298              ZCD_NV_NWK_MODE, sizeof(zgNwkMode), &zgNwkMode
    299            },
    300            {
    301              ZCD_NV_CONCENTRATOR_ENABLE, sizeof(zgConcentratorEnable), &zgConcentratorEnable
    302            },
    303            {
    304              ZCD_NV_CONCENTRATOR_DISCOVERY, sizeof(zgConcentratorDiscoveryTime), &zgConcentratorDiscoveryTime
    305            },
    306            {
    307              ZCD_NV_CONCENTRATOR_RADIUS, sizeof(zgConcentratorRadius), &zgConcentratorRadius
    308            },
    309            {
    310              ZCD_NV_CONCENTRATOR_RC, sizeof(zgConcentratorRC), &zgConcentratorRC
    311            },
    312          #ifndef NONWK
    313            {
    314              ZCD_NV_PANID, sizeof(zgConfigPANID), &zgConfigPANID
    315            },
    316            {
    317              ZCD_NV_PRECFGKEY, SEC_KEY_LEN, &zgPreConfigKey
    318            },
    319            {
    320              ZCD_NV_PRECFGKEYS_ENABLE, sizeof(zgPreConfigKeys), &zgPreConfigKeys
    321            },
    322            {
    323              ZCD_NV_SECURITY_MODE, sizeof(zgSecurityMode), &zgSecurityMode
    324            },
    325            {
    326              ZCD_NV_SECURE_PERMIT_JOIN, sizeof(zgSecurePermitJoin), &zgSecurePermitJoin
    327            },
    328            {
    329              ZCD_NV_USE_DEFAULT_TCLK, sizeof(zgUseDefaultTCLK), &zgUseDefaultTCLK
    330            },
    331            {
    332              ZCD_NV_TRUSTCENTER_ADDR, sizeof(zgTrustCenterAddr), &zgTrustCenterAddr
    333            },
    334          #if defined(ZCL_KEY_ESTABLISH)
    335            {
    336              ZCD_NV_RNG_COUNTER, sizeof(zgRNGCounter), &zgRNGCounter
    337            },
    338            {
    339              ZCD_NV_CA_PUBLIC_KEY, ZCL_KEY_ESTABLISHMENT_PUBLIC_KEY_LENGTH, zgCAPublicKey
    340            },
    341            {
    342              ZCD_NV_lOCAL_CERTIFICATE, ZCL_KEY_ESTABLISHMENT_CERTIFICATE_LENGTH, zgLocalCertificate
    343            },
    344            {
    345              ZCD_NV_STATIC_PRIVATE_KEY, ZCL_KEY_ESTABLSIHMENT_PRIVATE_KEY_LENTGH, zgStaticPrivateKey
    346            },
    347            {
    348              ZCD_NV_STATIC_PUBLIC_KEY, ZCL_KEY_ESTABLISHMENT_PUBLIC_KEY_LENGTH, zgRemotePublicKey
    349            },
    350          #endif // CBKE
    351          #endif // NONWK
    352            {
    353              ZCD_NV_APS_FRAME_RETRIES, sizeof(zgApscMaxFrameRetries), &zgApscMaxFrameRetries
    354            },
    355            {
    356              ZCD_NV_APS_ACK_WAIT_DURATION, sizeof(zgApscAckWaitDurationPolled), &zgApscAckWaitDurationPolled
    357            },
    358            {
    359              ZCD_NV_APS_ACK_WAIT_MULTIPLIER, sizeof(zgApsAckWaitMultiplier), &zgApsAckWaitMultiplier
    360            },
    361            {
    362              ZCD_NV_BINDING_TIME, sizeof(zgApsDefaultMaxBindingTime), &zgApsDefaultMaxBindingTime
    363            },
    364            {
    365              ZCD_NV_APS_USE_EXT_PANID, Z_EXTADDR_LEN, zgApsUseExtendedPANID
    366            },
    367            {
    368              ZCD_NV_APS_USE_INSECURE_JOIN, sizeof(zgApsUseInsecureJoin), &zgApsUseInsecureJoin
    369            },
    370            {
    371              ZCD_NV_APSF_WINDOW_SIZE, sizeof(zgApscMaxWindowSize), &zgApscMaxWindowSize
    372            },
    373            {
    374              ZCD_NV_APSF_INTERFRAME_DELAY, sizeof(zgApsInterframeDelay), &zgApsInterframeDelay
    375            },
    376            {
    377              ZCD_NV_APS_NONMEMBER_RADIUS, sizeof(zgApsNonMemberRadius), &zgApsNonMemberRadius
    378            },
    379            {
    380              ZCD_NV_START_DELAY, sizeof(zgStartDelay), &zgStartDelay
    381            },
    382            {
    383              ZCD_NV_SAPI_ENDPOINT, sizeof(zgSapiEndpoint), &zgSapiEndpoint
    384            },
    385            {
    386              ZCD_NV_NWK_MGR_MODE, sizeof(zgNwkMgrMode), &zgNwkMgrMode
    387            },
    388          #endif // NV_INIT
    389            // Last item -- DO NOT MOVE IT!
    390            {
    391              0x00, 0, NULL
    392            }
    393          };
    394          
    395          /*********************************************************************
    396           * LOCAL FUNCTIONS
    397           */
    398          
    399          static uint8 zgItemInit( uint16 id, uint16 len, void *buf, uint8 setDefault );
    400          
    401          
    402          /*********************************************************************
    403           * @fn       zgItemInit()
    404           *
    405           * @brief
    406           *
    407           *   Initialize a global item. If the item doesn't exist in NV memory,
    408           *   write the system default (value passed in) into NV memory. But if
    409           *   it exists, set the item to the value stored in NV memory.
    410           *
    411           *   Also, if setDefault is TRUE and the item exists, we will write
    412           *   the default value to NV space.
    413           *
    414           * @param   id - item id
    415           * @param   len - item len
    416           * @param   buf - pointer to the item
    417           * @param   setDefault - TRUE to set default, not read
    418           *
    419           * @return  ZSUCCESS if successful, NV_ITEM_UNINIT if item did not
    420           *          exist in NV, NV_OPER_FAILED if failure.
    421           */
    422          static uint8 zgItemInit( uint16 id, uint16 len, void *buf, uint8 setDefault )
    423          {
    424          
    425            uint8 status;
    426          
    427            // If the item doesn't exist in NV memory, create and initialize
    428            // it with the value passed in.
    429            status = osal_nv_item_init( id, len, buf );
    430            if ( status == ZSUCCESS )
    431            {
    432              if ( setDefault )
    433              {
    434                // Write the default value back to NV
    435                status =  osal_nv_write( id, 0, len, buf );
    436              }
    437              else
    438              {
    439                // The item exists in NV memory, read it from NV memory
    440                status = osal_nv_read( id, 0, len, buf );
    441              }
    442            }
    443          
    444            return (status);
    445          }
    446          
    447          /*********************************************************************
    448           * API FUNCTIONS
    449           */
    450          
    451          
    452          /*********************************************************************
    453           * @fn          zgInit
    454           *
    455           * @brief
    456           *
    457           *   Initialize the Z-Stack Globals. If an item doesn't exist in
    458           *   NV memory, write the system default into NV memory. But if
    459           *   it exists, set the item to the value stored in NV memory.
    460           *
    461           * NOTE: The Startup Options (ZCD_NV_STARTUP_OPTION) indicate
    462           *       that the Config state items (zgItemTable) need to be
    463           *       set to defaults (ZCD_STARTOPT_DEFAULT_CONFIG_STATE). The
    464           *
    465           *
    466           * @param       none
    467           *
    468           * @return      ZSUCCESS if successful, NV_ITEM_UNINIT if item did not
    469           *              exist in NV, NV_OPER_FAILED if failure.
    470           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    471          uint8 zgInit( void )
   \                     zgInit:
    472          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 0
    473            uint8  setDefault = FALSE;
   \   000005   7E00         MOV     R6,#0x0
    474          
    475            // Do we want to default the Config state values
    476            if ( zgReadStartupOptions() & ZCD_STARTOPT_DEFAULT_CONFIG_STATE )
   \   000007                ; Setup parameters for call to function zgReadStartupOptions
   \   000007   12....       LCALL   ??zgReadStartupOptions?relay
   \   00000A   E9           MOV     A,R1
   \   00000B   A2E0         MOV     C,0xE0 /* A   */.0
   \   00000D   5001         JNC     ??zgInit_0
    477            {
    478              setDefault = TRUE;
   \   00000F   0E           INC     R6
    479            }
    480          
    481          #if 0
    482            // Enable this section if you need to track the number of resets
    483            // This section is normally disabled to minimize "wear" on NV memory
    484            uint16 bootCnt = 0;
    485          
    486            // Update the Boot Counter
    487            if ( osal_nv_item_init( ZCD_NV_BOOTCOUNTER, sizeof(bootCnt), &bootCnt ) == ZSUCCESS )
    488            {
    489              // Get the old value from NV memory
    490              osal_nv_read( ZCD_NV_BOOTCOUNTER, 0, sizeof(bootCnt), &bootCnt );
    491            }
    492          
    493            // Increment the Boot Counter and store it into NV memory
    494            if ( setDefault )
    495              bootCnt = 0;
    496            else
    497              bootCnt++;
    498            osal_nv_write( ZCD_NV_BOOTCOUNTER, 0, sizeof(bootCnt), &bootCnt );
    499          #endif
    500          
    501            // Initialize the Extended PAN ID as my own extended address
    502            ZMacGetReq( ZMacExtAddr, zgExtendedPANID );
   \                     ??zgInit_0:
   \   000010                ; Setup parameters for call to function ZMacGetReq
   \   000010   7A..         MOV     R2,#zgExtendedPANID & 0xff
   \   000012   7B..         MOV     R3,#(zgExtendedPANID >> 8) & 0xff
   \   000014   79E2         MOV     R1,#-0x1e
   \   000016   12....       LCALL   ??ZMacGetReq?relay
    503          
    504          #ifndef NONWK
    505            // Initialize the Pre-Configured Key to the default key
    506            osal_memcpy( zgPreConfigKey, defaultKey, SEC_KEY_LEN );  // Do NOT Change!!!
   \   000019                ; Setup parameters for call to function osal_memcpy
   \   000019   75....       MOV     ?V0 + 0,#defaultKey & 0xff
   \   00001C   75....       MOV     ?V0 + 1,#(defaultKey >> 8) & 0xff
   \   00001F   75..80       MOV     ?V0 + 2,#-0x80
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000027   7C10         MOV     R4,#0x10
   \   000029   7D00         MOV     R5,#0x0
   \   00002B   7A..         MOV     R2,#zgPreConfigKey & 0xff
   \   00002D   7B..         MOV     R3,#(zgPreConfigKey >> 8) & 0xff
   \   00002F   12....       LCALL   ??osal_memcpy?relay
   \   000032   7403         MOV     A,#0x3
   \   000034   12....       LCALL   ?DEALLOC_XSTACK8
    507          #endif // NONWK
    508          
    509            // Initialize the items table
    510            zgInitItems( setDefault );
   \   000037                ; Setup parameters for call to function zgInitItems
   \   000037   EE           MOV     A,R6
   \   000038   F9           MOV     R1,A
   \   000039   12....       LCALL   ??zgInitItems?relay
    511          
    512            // Clear the Config State default
    513            if ( setDefault )
   \   00003C   EE           MOV     A,R6
   \   00003D   A2E0         MOV     C,0xE0 /* A   */.0
   \   00003F   5007         JNC     ??zgInit_1
    514            {
    515              zgWriteStartupOptions( ZG_STARTUP_CLEAR, ZCD_STARTOPT_DEFAULT_CONFIG_STATE );
   \   000041                ; Setup parameters for call to function zgWriteStartupOptions
   \   000041   7A01         MOV     R2,#0x1
   \   000043   7900         MOV     R1,#0x0
   \   000045   12....       LCALL   ??zgWriteStartupOptions?relay
    516            }
    517          
    518            return ( ZSUCCESS );
   \                     ??zgInit_1:
   \   000048   7900         MOV     R1,#0x0
   \   00004A                REQUIRE ?Subroutine0
   \   00004A                ; // Fall through to label ?Subroutine0
    519          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7F03         MOV     R7,#0x3
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    520          
    521          /*********************************************************************
    522           * @fn          zgInitItems
    523           *
    524           * @brief       Initializes RAM variables from NV.  If NV items don't
    525           *              exist, then the NV is initialize with what is in RAM
    526           *              variables.
    527           *
    528           * @param       none
    529           *
    530           * @return      none
    531           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    532          void zgInitItems( uint8 setDefault )
   \                     zgInitItems:
    533          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 5,R1
    534            uint8  i = 0;
   \   000007   75..00       MOV     ?V0 + 4,#0x0
   \   00000A   801A         SJMP    ??zgInitItems_0
    535          
    536            while ( zgItemTable[i].id != 0x00 )
    537            {
   \                     ??zgInitItems_1:
   \   00000C                ; Setup parameters for call to function osal_nv_read
   \   00000C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00000F   78..         MOV     R0,#?V0 + 0
   \   000011   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000014   7C00         MOV     R4,#0x0
   \   000016   7D00         MOV     R5,#0x0
   \   000018   EE           MOV     A,R6
   \   000019   FA           MOV     R2,A
   \   00001A   EF           MOV     A,R7
   \   00001B   FB           MOV     R3,A
   \   00001C   12....       LCALL   ??osal_nv_read?relay
   \                     ??zgInitItems_2:
   \   00001F   7404         MOV     A,#0x4
   \   000021   12....       LCALL   ?DEALLOC_XSTACK8
    538              // Initialize the item
    539              zgItemInit( zgItemTable[i].id, zgItemTable[i].len, zgItemTable[i].buf, setDefault  );
    540          
    541              // Move on to the next item
    542              i++;
   \                     ??zgInitItems_3:
   \   000024   05..         INC     ?V0 + 4
   \                     ??zgInitItems_0:
   \   000026   E5..         MOV     A,?V0 + 4
   \   000028   75F006       MOV     B,#0x6
   \   00002B   A4           MUL     AB
   \   00002C   F8           MOV     R0,A
   \   00002D   A9F0         MOV     R1,B
   \   00002F   74..         MOV     A,#zgItemTable & 0xff
   \   000031   28           ADD     A,R0
   \   000032   F8           MOV     R0,A
   \   000033   74..         MOV     A,#(zgItemTable >> 8) & 0xff
   \   000035   39           ADDC    A,R1
   \   000036   F9           MOV     R1,A
   \   000037   8882         MOV     DPL,R0
   \   000039   8983         MOV     DPH,R1
   \   00003B   E4           CLR     A
   \   00003C   93           MOVC    A,@A+DPTR
   \   00003D   FA           MOV     R2,A
   \   00003E   7401         MOV     A,#0x1
   \   000040   93           MOVC    A,@A+DPTR
   \   000041   FB           MOV     R3,A
   \   000042   EA           MOV     A,R2
   \   000043   4B           ORL     A,R3
   \   000044   606E         JZ      ??zgInitItems_4
   \   000046   A3           INC     DPTR
   \   000047   A3           INC     DPTR
   \   000048   A3           INC     DPTR
   \   000049   A3           INC     DPTR
   \   00004A   E4           CLR     A
   \   00004B   93           MOVC    A,@A+DPTR
   \   00004C   F5..         MOV     ?V0 + 2,A
   \   00004E   7401         MOV     A,#0x1
   \   000050   93           MOVC    A,@A+DPTR
   \   000051   F5..         MOV     ?V0 + 3,A
   \   000053   8882         MOV     DPL,R0
   \   000055   8983         MOV     DPH,R1
   \   000057   A3           INC     DPTR
   \   000058   A3           INC     DPTR
   \   000059   E4           CLR     A
   \   00005A   93           MOVC    A,@A+DPTR
   \   00005B   C0E0         PUSH    A
   \   00005D   7401         MOV     A,#0x1
   \   00005F   93           MOVC    A,@A+DPTR
   \   000060   F583         MOV     DPH,A
   \   000062   D082         POP     DPL
   \   000064   8582..       MOV     ?V0 + 0,DPL
   \   000067   8583..       MOV     ?V0 + 1,DPH
   \   00006A   8882         MOV     DPL,R0
   \   00006C   8983         MOV     DPH,R1
   \   00006E   E4           CLR     A
   \   00006F   93           MOVC    A,@A+DPTR
   \   000070   C0E0         PUSH    A
   \   000072   7401         MOV     A,#0x1
   \   000074   93           MOVC    A,@A+DPTR
   \   000075   F583         MOV     DPH,A
   \   000077   D082         POP     DPL
   \   000079   AE82         MOV     R6,DPL
   \   00007B   AF83         MOV     R7,DPH
   \   00007D                ; Setup parameters for call to function osal_nv_item_init
   \   00007D   78..         MOV     R0,#?V0 + 2
   \   00007F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000082   AC..         MOV     R4,?V0 + 0
   \   000084   AD..         MOV     R5,?V0 + 1
   \   000086   EE           MOV     A,R6
   \   000087   FA           MOV     R2,A
   \   000088   EF           MOV     A,R7
   \   000089   FB           MOV     R3,A
   \   00008A   12....       LCALL   ??osal_nv_item_init?relay
   \   00008D   7402         MOV     A,#0x2
   \   00008F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000092   E9           MOV     A,R1
   \   000093   708F         JNZ     ??zgInitItems_3
   \   000095   E5..         MOV     A,?V0 + 5
   \   000097   78..         MOV     R0,#?V0 + 2
   \   000099   7003         JNZ     $+5
   \   00009B   02....       LJMP    ??zgInitItems_1 & 0xFFFF
   \   00009E                ; Setup parameters for call to function osal_nv_write
   \   00009E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000A1   78..         MOV     R0,#?V0 + 0
   \   0000A3   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000A6   7C00         MOV     R4,#0x0
   \   0000A8   7D00         MOV     R5,#0x0
   \   0000AA   EE           MOV     A,R6
   \   0000AB   FA           MOV     R2,A
   \   0000AC   EF           MOV     A,R7
   \   0000AD   FB           MOV     R3,A
   \   0000AE   12....       LCALL   ??osal_nv_write?relay
   \   0000B1   02....       LJMP    ??zgInitItems_2 & 0xFFFF
    543            }
    544          }
   \                     ??zgInitItems_4:
   \   0000B4   7F06         MOV     R7,#0x6
   \   0000B6   02....       LJMP    ?BANKED_LEAVE_XDATA
    545          
    546          /*********************************************************************
    547           * @fn          zgReadStartupOptions
    548           *
    549           * @brief       Reads the ZCD_NV_STARTUP_OPTION NV Item.
    550           *
    551           * @param       none
    552           *
    553           * @return      the ZCD_NV_STARTUP_OPTION NV item
    554           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    555          uint8 zgReadStartupOptions( void )
   \                     zgReadStartupOptions:
    556          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    557            // Default to Use Config State and Use Network State
    558            uint8 startupOption = 0;
   \   00000A   12....       LCALL   ?Subroutine2 & 0xFFFF
    559          
    560            // This should have been done in ZMain.c, but just in case.
    561            if ( osal_nv_item_init( ZCD_NV_STARTUP_OPTION,
    562                                        sizeof(startupOption),
    563                                        &startupOption ) == ZSUCCESS )
   \                     ??CrossCallReturnLabel_0:
   \   00000D   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000010   7C01         MOV     R4,#0x1
   \   000012   7D00         MOV     R5,#0x0
   \   000014   7A03         MOV     R2,#0x3
   \   000016   7B00         MOV     R3,#0x0
   \   000018   12....       LCALL   ??osal_nv_item_init?relay
   \   00001B   7402         MOV     A,#0x2
   \   00001D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000020   E9           MOV     A,R1
   \   000021   7020         JNZ     ??zgReadStartupOptions_0
    564            {
    565              // Read saved startup control
    566              osal_nv_read( ZCD_NV_STARTUP_OPTION,
    567                            0,
    568                            sizeof( startupOption ),
    569                            &startupOption);
   \   000023                ; Setup parameters for call to function osal_nv_read
   \   000023   78..         MOV     R0,#?V0 + 0
   \   000025   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000028   75..01       MOV     ?V0 + 0,#0x1
   \   00002B   75..00       MOV     ?V0 + 1,#0x0
   \   00002E   78..         MOV     R0,#?V0 + 0
   \   000030   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000033   7C00         MOV     R4,#0x0
   \   000035   7D00         MOV     R5,#0x0
   \   000037   7A03         MOV     R2,#0x3
   \   000039   7B00         MOV     R3,#0x0
   \   00003B   12....       LCALL   ??osal_nv_read?relay
   \   00003E   7404         MOV     A,#0x4
   \   000040   12....       LCALL   ?DEALLOC_XSTACK8
    570            }
    571            return ( startupOption );
   \                     ??zgReadStartupOptions_0:
   \   000043   85..82       MOV     DPL,?XSP + 0
   \   000046   85..83       MOV     DPH,?XSP + 1
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   F9           MOV     R1,A
   \   00004B                REQUIRE ?Subroutine1
   \   00004B                ; // Fall through to label ?Subroutine1
    572          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7401         MOV     A,#0x1
   \   000002   12....       LCALL   ?DEALLOC_XSTACK8
   \   000005   7F02         MOV     R7,#0x2
   \   000007   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006   E4           CLR     A
   \   000007                REQUIRE ??Subroutine3_0
   \   000007                ; // Fall through to label ??Subroutine3_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine3_0:
   \   000000   F0           MOVX    @DPTR,A
   \   000001                ; Setup parameters for call to function osal_nv_item_init
   \   000001                ; Setup parameters for call to function osal_nv_read
   \   000001                ; Setup parameters for call to function osal_nv_write
   \   000001   8582..       MOV     ?V0 + 0,DPL
   \   000004   8583..       MOV     ?V0 + 1,DPH
   \   000007   78..         MOV     R0,#?V0 + 0
   \   000009   22           RET
    573          
    574          /*********************************************************************
    575           * @fn          zgWriteStartupOptions
    576           *
    577           * @brief       Writes bits into the ZCD_NV_STARTUP_OPTION NV Item.
    578           *
    579           * @param       action - ZG_STARTUP_SET set bit, ZG_STARTUP_CLEAR to
    580           *               clear bit. The set bit is an OR operation, and the
    581           *               clear bit is an AND ~(bitOptions) operation.
    582           *
    583           * @param       bitOptions - which bits to perform action on:
    584           *                      ZCD_STARTOPT_DEFAULT_CONFIG_STATE
    585           *                      ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    586           *
    587           * @return      ZSUCCESS if successful
    588           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    589          uint8 zgWriteStartupOptions( uint8 action, uint8 bitOptions )
   \                     zgWriteStartupOptions:
    590          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
   \   00000C   EA           MOV     A,R2
   \   00000D   FF           MOV     R7,A
    591            uint8 status;
    592            uint8 startupOptions = 0;
   \   00000E   12....       LCALL   ?Subroutine2 & 0xFFFF
    593          
    594            status = osal_nv_read( ZCD_NV_STARTUP_OPTION,
    595                          0,
    596                          sizeof( startupOptions ),
    597                          &startupOptions );
   \                     ??CrossCallReturnLabel_1:
   \   000011   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000014   75..01       MOV     ?V0 + 0,#0x1
   \   000017   75..00       MOV     ?V0 + 1,#0x0
   \   00001A   78..         MOV     R0,#?V0 + 0
   \   00001C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001F   7C00         MOV     R4,#0x0
   \   000021   7D00         MOV     R5,#0x0
   \   000023   7A03         MOV     R2,#0x3
   \   000025   7B00         MOV     R3,#0x0
   \   000027   12....       LCALL   ??osal_nv_read?relay
   \   00002A   7404         MOV     A,#0x4
   \   00002C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00002F   E9           MOV     A,R1
    598          
    599            if ( status == ZSUCCESS )
   \   000030   703C         JNZ     ??zgWriteStartupOptions_0
    600            {
    601              if ( action == ZG_STARTUP_SET )
   \   000032   74FF         MOV     A,#-0x1
   \   000034   6E           XRL     A,R6
   \   000035   700A         JNZ     ??zgWriteStartupOptions_1
    602              {
    603                // Set bits
    604                startupOptions |= bitOptions;
   \   000037   85..82       MOV     DPL,?XSP + 0
   \   00003A   85..83       MOV     DPH,?XSP + 1
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   4F           ORL     A,R7
   \   00003F   800C         SJMP    ??zgWriteStartupOptions_2
    605              }
    606              else
    607              {
    608                // Clear bits
    609                startupOptions &= (bitOptions ^ 0xFF);
   \                     ??zgWriteStartupOptions_1:
   \   000041   74FF         MOV     A,#-0x1
   \   000043   6F           XRL     A,R7
   \   000044   F8           MOV     R0,A
   \   000045   85..82       MOV     DPL,?XSP + 0
   \   000048   85..83       MOV     DPH,?XSP + 1
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   58           ANL     A,R0
    610              }
    611          
    612              // Changed?
    613              status = osal_nv_write( ZCD_NV_STARTUP_OPTION,
    614                           0,
    615                           sizeof( startupOptions ),
    616                           &startupOptions );
    617            }
   \                     ??zgWriteStartupOptions_2:
   \   00004D   12....       LCALL   ??Subroutine3_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   000050   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000053   75..01       MOV     ?V0 + 0,#0x1
   \   000056   75..00       MOV     ?V0 + 1,#0x0
   \   000059   78..         MOV     R0,#?V0 + 0
   \   00005B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00005E   7C00         MOV     R4,#0x0
   \   000060   7D00         MOV     R5,#0x0
   \   000062   7A03         MOV     R2,#0x3
   \   000064   7B00         MOV     R3,#0x0
   \   000066   12....       LCALL   ??osal_nv_write?relay
   \   000069   7404         MOV     A,#0x4
   \   00006B   12....       LCALL   ?DEALLOC_XSTACK8
    618          
    619            return ( status );
   \                     ??zgWriteStartupOptions_0:
   \   00006E   02....       LJMP    ?Subroutine1 & 0xFFFF
    620          }
    621          
    622          /*********************************************************************
    623           * @fn          zgSetItem
    624           *
    625           * @brief       Set RAM variables from set-NV, if it exist in the zgItemTable
    626           *
    627           * @param       id - NV ID
    628           *              len - NV item length
    629           *              buf - pointer to the input buffer
    630           *
    631           * @return      none
    632           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    633          void zgSetItem( uint16 id, uint16 len, void *buf )
   \                     zgSetItem:
    634          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 0
   \   000005   740B         MOV     A,#0xb
   \   000007   12....       LCALL   ?XSTACK_DISP0_8
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   F5..         MOV     ?V0 + 0,A
   \   00000D   A3           INC     DPTR
   \   00000E   E0           MOVX    A,@DPTR
   \   00000F   F5..         MOV     ?V0 + 1,A
    635          
    636            uint8  i = 0;
   \   000011   75..00       MOV     ?V0 + 2,#0x0
   \   000014   8002         SJMP    ??zgSetItem_0
    637          
    638            // Look up the NV item table
    639            while ( zgItemTable[i].id != 0x00 )
    640            {
    641              if( zgItemTable[i].id == id )
    642              {
    643                if ( zgItemTable[i].len == len )
    644                {
    645                  osal_memcpy( zgItemTable[i].buf, buf, len );
    646                }
    647                break;
    648              }
    649              // Move on to the next item
    650              i++;
   \                     ??zgSetItem_1:
   \   000016   05..         INC     ?V0 + 2
   \                     ??zgSetItem_0:
   \   000018   E5..         MOV     A,?V0 + 2
   \   00001A   75F006       MOV     B,#0x6
   \   00001D   A4           MUL     AB
   \   00001E   F8           MOV     R0,A
   \   00001F   A9F0         MOV     R1,B
   \   000021   74..         MOV     A,#zgItemTable & 0xff
   \   000023   28           ADD     A,R0
   \   000024   F8           MOV     R0,A
   \   000025   74..         MOV     A,#(zgItemTable >> 8) & 0xff
   \   000027   39           ADDC    A,R1
   \   000028   F9           MOV     R1,A
   \   000029   E8           MOV     A,R0
   \   00002A   FE           MOV     R6,A
   \   00002B   E9           MOV     A,R1
   \   00002C   FF           MOV     R7,A
   \   00002D   8E82         MOV     DPL,R6
   \   00002F   8F83         MOV     DPH,R7
   \   000031   E4           CLR     A
   \   000032   93           MOVC    A,@A+DPTR
   \   000033   C0E0         PUSH    A
   \   000035   7401         MOV     A,#0x1
   \   000037   93           MOVC    A,@A+DPTR
   \   000038   F583         MOV     DPH,A
   \   00003A   D082         POP     DPL
   \   00003C   A882         MOV     R0,DPL
   \   00003E   A983         MOV     R1,DPH
   \   000040   E8           MOV     A,R0
   \   000041   49           ORL     A,R1
   \   000042   603C         JZ      ??zgSetItem_2
   \   000044   EA           MOV     A,R2
   \   000045   68           XRL     A,R0
   \   000046   7002         JNZ     ??zgSetItem_3
   \   000048   EB           MOV     A,R3
   \   000049   69           XRL     A,R1
   \                     ??zgSetItem_3:
   \   00004A   70CA         JNZ     ??zgSetItem_1
   \   00004C   8E82         MOV     DPL,R6
   \   00004E   8F83         MOV     DPH,R7
   \   000050   A3           INC     DPTR
   \   000051   A3           INC     DPTR
   \   000052   E4           CLR     A
   \   000053   93           MOVC    A,@A+DPTR
   \   000054   F8           MOV     R0,A
   \   000055   7401         MOV     A,#0x1
   \   000057   93           MOVC    A,@A+DPTR
   \   000058   F9           MOV     R1,A
   \   000059   EC           MOV     A,R4
   \   00005A   68           XRL     A,R0
   \   00005B   7002         JNZ     ??zgSetItem_4
   \   00005D   ED           MOV     A,R5
   \   00005E   69           XRL     A,R1
   \                     ??zgSetItem_4:
   \   00005F   701F         JNZ     ??zgSetItem_2
   \   000061                ; Setup parameters for call to function osal_memcpy
   \   000061   75..00       MOV     ?V0 + 2,#0x0
   \   000064   78..         MOV     R0,#?V0 + 0
   \   000066   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000069   8E82         MOV     DPL,R6
   \   00006B   8F83         MOV     DPH,R7
   \   00006D   A3           INC     DPTR
   \   00006E   A3           INC     DPTR
   \   00006F   A3           INC     DPTR
   \   000070   A3           INC     DPTR
   \   000071   E4           CLR     A
   \   000072   93           MOVC    A,@A+DPTR
   \   000073   FA           MOV     R2,A
   \   000074   7401         MOV     A,#0x1
   \   000076   93           MOVC    A,@A+DPTR
   \   000077   FB           MOV     R3,A
   \   000078   12....       LCALL   ??osal_memcpy?relay
   \   00007B   7403         MOV     A,#0x3
   \   00007D   12....       LCALL   ?DEALLOC_XSTACK8
    651            }
    652          
    653          }
   \                     ??zgSetItem_2:
   \   000080   02....       LJMP    ?Subroutine0 & 0xFFFF

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgPollRate>`:
   \   000000   E803         DW 1000

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgQueuedPollRate>`:
   \   000000   6400         DW 100

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgResponsePollRate>`:
   \   000000   6400         DW 100

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgRejoinPollRate>`:
   \   000000   B801         DW 440

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgMaxDataRetries>`:
   \   000000   02           DB 2

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgMaxPollFailureRetries>`:
   \   000000   02           DB 2

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgDefaultChannelList>`:
   \   000000   00080000     DD 2048

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgDefaultStartingScanDuratio`:
   \   000000   05           DB 5

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgStackProfile>`:
   \   000000   02           DB 2

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgIndirectMsgTimeout>`:
   \   000000   07           DB 7

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgSecurePermitJoin>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgRouteExpiryTime>`:
   \   000000   1E           DB 30

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgMaxBcastRetires>`:
   \   000000   02           DB 2

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgPassiveAckTimeout>`:
   \   000000   05           DB 5

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgBcastDeliveryTime>`:
   \   000000   1E           DB 30

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgNwkMode>`:
   \   000000   02           DB 2

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgConcentratorRadius>`:
   \   000000   0A           DB 10

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgApscMaxFrameRetries>`:
   \   000000   03           DB 3

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgApscAckWaitDurationPolled>`:
   \   000000   B80B         DW 3000

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgApsAckWaitMultiplier>`:
   \   000000   02           DB 2

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgApsDefaultMaxBindingTime>`:
   \   000000   803E         DW 16000

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgApsUseInsecureJoin>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgApscMaxWindowSize>`:
   \   000000   03           DB 3

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgApsInterframeDelay>`:
   \   000000   3200         DW 50

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgApsNonMemberRadius>`:
   \   000000   02           DB 2

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgUseDefaultTCLK>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgConfigPANID>`:
   \   000000   F0FF         DW 65520

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgStartDelay>`:
   \   000000   0A           DB 10

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgNwkMgrMode>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zgSapiEndpoint>`:
   \   000000   E0           DB 224

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zgInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zgInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zgInitItems?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zgInitItems

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zgReadStartupOptions?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zgReadStartupOptions

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zgWriteStartupOptions?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zgWriteStartupOptions

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zgSetItem?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zgSetItem
    654          
    655          
    656          /*********************************************************************
    657          *********************************************************************/

   Maximum stack usage in bytes:

     Function                   ISTACK PSTACK XSTACK
     --------                   ------ ------ ------
     zgInit                         0      0     14
       -> zgReadStartupOptions      0      0     22
       -> ZMacGetReq                0      0     22
       -> osal_memcpy               0      0     28
       -> zgInitItems               0      0     22
       -> zgWriteStartupOptions     0      0     22
     zgInitItems                    0      0     29
       -> osal_nv_read              0      0     36
       -> osal_nv_item_init         0      0     32
       -> osal_nv_write             0      0     36
     zgReadStartupOptions           0      0     26
       -> osal_nv_item_init         0      0     26
       -> osal_nv_read              0      0     30
     zgSetItem                      0      0     16
       -> osal_memcpy               0      0     28
     zgWriteStartupOptions          0      0     26
       -> osal_nv_read              0      0     30
       -> osal_nv_write             0      0     30


   Segment part sizes:

     Function/Label                                 Bytes
     --------------                                 -----
     zgPollRate                                        2
     zgQueuedPollRate                                  2
     zgResponsePollRate                                2
     zgRejoinPollRate                                  2
     zgMaxDataRetries                                  1
     zgMaxPollFailureRetries                           1
     zgDefaultChannelList                              4
     zgDefaultStartingScanDuration                     1
     zgStackProfile                                    1
     zgIndirectMsgTimeout                              1
     zgSecurityMode                                    1
     zgSecurePermitJoin                                1
     zgTrustCenterAddr                                 2
     zgRouteExpiryTime                                 1
     zgExtendedPANID                                   8
     zgMaxBcastRetires                                 1
     zgPassiveAckTimeout                               1
     zgBcastDeliveryTime                               1
     zgNwkMode                                         1
     zgConcentratorEnable                              1
     zgConcentratorDiscoveryTime                       1
     zgConcentratorRadius                              1
     zgConcentratorRC                                  1
     zgApscMaxFrameRetries                             1
     zgApscAckWaitDurationPolled                       2
     zgApsAckWaitMultiplier                            1
     zgApsDefaultMaxBindingTime                        2
     zgApsUseExtendedPANID                             8
     zgApsUseInsecureJoin                              1
     zgApscMaxWindowSize                               1
     zgApsInterframeDelay                              2
     zgApsNonMemberRadius                              1
     zgPreConfigKey                                   16
     zgPreConfigKeys                                   1
     zgUseDefaultTCLK                                  1
     zgConfigPANID                                     2
     zgDeviceLogicalType                               1
     zgStartDelay                                      1
     zgNwkMgrMode                                      1
     zgSapiEndpoint                                    1
     zgItemTable                                       6
     zgInit                                           74
     ?Subroutine0                                      5
     zgInitItems                                     185
     zgReadStartupOptions                             75
     ?Subroutine1                                     10
     ?Subroutine2                                      7
     ??Subroutine3_0                                  10
     zgWriteStartupOptions                           113
     zgSetItem                                       131
     ?<Initializer for zgPollRate>                     2
     ?<Initializer for zgQueuedPollRate>               2
     ?<Initializer for zgResponsePollRate>             2
     ?<Initializer for zgRejoinPollRate>               2
     ?<Initializer for zgMaxDataRetries>               1
     ?<Initializer for zgMaxPollFailureRetries>        1
     ?<Initializer for zgDefaultChannelList>           4
     ?<Initializer for zgDefaultStartingScanDuratio    1
     ?<Initializer for zgStackProfile>                 1
     ?<Initializer for zgIndirectMsgTimeout>           1
     ?<Initializer for zgSecurePermitJoin>             1
     ?<Initializer for zgRouteExpiryTime>              1
     ?<Initializer for zgMaxBcastRetires>              1
     ?<Initializer for zgPassiveAckTimeout>            1
     ?<Initializer for zgBcastDeliveryTime>            1
     ?<Initializer for zgNwkMode>                      1
     ?<Initializer for zgConcentratorRadius>           1
     ?<Initializer for zgApscMaxFrameRetries>          1
     ?<Initializer for zgApscAckWaitDurationPolled>    2
     ?<Initializer for zgApsAckWaitMultiplier>         1
     ?<Initializer for zgApsDefaultMaxBindingTime>     2
     ?<Initializer for zgApsUseInsecureJoin>           1
     ?<Initializer for zgApscMaxWindowSize>            1
     ?<Initializer for zgApsInterframeDelay>           2
     ?<Initializer for zgApsNonMemberRadius>           1
     ?<Initializer for zgUseDefaultTCLK>               1
     ?<Initializer for zgConfigPANID>                  2
     ?<Initializer for zgStartDelay>                   1
     ?<Initializer for zgNwkMgrMode>                   1
     ?<Initializer for zgSapiEndpoint>                 1
     ??zgInit?relay                                    6
     ??zgInitItems?relay                               6
     ??zgReadStartupOptions?relay                      6
     ??zgWriteStartupOptions?relay                     6
     ??zgSetItem?relay                                 6

 
 610 bytes in segment BANKED_CODE
  30 bytes in segment BANK_RELAYS
   6 bytes in segment CODE_C
  41 bytes in segment XDATA_I
  41 bytes in segment XDATA_ID
  40 bytes in segment XDATA_Z
 
 687 bytes of CODE  memory
  81 bytes of XDATA memory

Errors: none
Warnings: none
