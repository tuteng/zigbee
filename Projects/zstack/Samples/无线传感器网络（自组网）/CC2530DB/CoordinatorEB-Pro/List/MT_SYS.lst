###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         04/May/2014  16:34:59 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\ #
#                          Components\mt\MT_SYS.c                             #
#    Command line       =  -f H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä #
#                          £©\Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£ #
#                          ©\CC2530DB\..\..\..\Tools\CC2530DB\f8wCoord.cfg    #
#                          (-DCPU32MHZ -DROOT=__near_func                     #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS) -f       #
#                          H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\ #
#                          Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\C #
#                          C2530DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg      #
#                          (-DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR      #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFF0                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\ #
#                          Components\mt\MT_SYS.c -D ZIGBEEPRO -D ZTOOL_P1    #
#                          -D NWK_AUTO_POLL -D xMT_TASK -D xMT_SYS_FUNC -D    #
#                          xMT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG -lC            #
#                          H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\ #
#                          Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\C #
#                          C2530DB\CoordinatorEB-Pro\List\ -lA                #
#                          H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\ #
#                          Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\C #
#                          C2530DB\CoordinatorEB-Pro\List\ --diag_suppress    #
#                          Pe001,Pa010 -o H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×é #
#                          ÍøÓëÊý¾Ý´«Êä£©\Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷Í #
#                          øÂç£¨×Ô×éÍø£©\CC2530DB\CoordinatorEB-Pro\Obj\ -e   #
#                          --debug --core=plain --dptr=16,1                   #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä #
#                          £©\Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£ #
#                          ©\CC2530DB\ -I H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×é #
#                          ÍøÓëÊý¾Ý´«Êä£©\Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷Í #
#                          øÂç£¨×Ô×éÍø£©\CC2530DB\..\SOURCE\ -I               #
#                          H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\ #
#                          Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\C #
#                          C2530DB\..\..\..\ZMAIN\TI2530DB\ -I                #
#                          H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\ #
#                          Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\C #
#                          C2530DB\..\..\..\..\..\COMPONENTS\MT\ -I           #
#                          H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\ #
#                          Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\C #
#                          C2530DB\..\..\..\..\..\COMPONENTS\HAL\INCLUDE\ -I  #
#                          H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\ #
#                          Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\C #
#                          C2530DB\..\..\..\..\..\COMPONENTS\HAL\TARGET\CC253 #
#                          0EB\ -I H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾ #
#                          Ý´«Êä£©\Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô #
#                          ×éÍø£©\CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\MCU #
#                          \CCSOC\ -I H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓë #
#                          Êý¾Ý´«Êä£©\Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£ #
#                          ¨×Ô×éÍø£©\CC2530DB\..\..\..\..\..\COMPONENTS\OSAL\ #
#                          INCLUDE\ -I H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓ #
#                          ëÊý¾Ý´«Êä£©\Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç #
#                          £¨×Ô×éÍø£©\CC2530DB\..\..\..\..\..\COMPONENTS\STAC #
#                          K\AF\ -I H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý #
#                          ¾Ý´«Êä£©\Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨× #
#                          Ô×éÍø£©\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\N #
#                          WK\ -I H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý #
#                          ´«Êä£©\Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô× #
#                          éÍø£©\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SEC #
#                          \ -I H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´« #
#                          Êä£©\Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍ #
#                          ø£©\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SAPI\ #
#                           -I H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Ê #
#                          ä£©\Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø #
#                          £©\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\SYS\   #
#                          -I H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä #
#                          £©\Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£ #
#                          ©\CC2530DB\..\..\..\..\..\COMPONENTS\STACK\ZDO\    #
#                          -I H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä #
#                          £©\Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£ #
#                          ©\CC2530DB\..\..\..\..\..\COMPONENTS\ZMAC\F8W\ -I  #
#                          H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\ #
#                          Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\C #
#                          C2530DB\..\..\..\..\..\COMPONENTS\ZMAC\ -I         #
#                          H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\ #
#                          Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\C #
#                          C2530DB\..\..\..\..\..\COMPONENTS\SERVICES\SADDR\  #
#                          -I H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä #
#                          £©\Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£ #
#                          ©\CC2530DB\..\..\..\..\..\COMPONENTS\SERVICES\SDAT #
#                          A\ -I H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´ #
#                          «Êä£©\Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×é #
#                          Íø£©\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\INCLUD #
#                          E\ -I H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´ #
#                          «Êä£©\Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×é #
#                          Íø£©\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\HIGH_L #
#                          EVEL\ -I H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý #
#                          ¾Ý´«Êä£©\Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨× #
#                          Ô×éÍø£©\CC2530DB\..\..\..\..\..\COMPONENTS\MAC\LOW #
#                          _LEVEL\srf04\ -I H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô #
#                          ×éÍøÓëÊý¾Ý´«Êä£©\Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ #
#                          ÷ÍøÂç£¨×Ô×éÍø£©\CC2530DB\..\..\..\..\..\COMPONENTS #
#                          \MAC\LOW_LEVEL\srf04\SINGLE_CHIP\ -Ohz             #
#    List file          =  H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\ #
#                          Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\C #
#                          C2530DB\CoordinatorEB-Pro\List\MT_SYS.lst          #
#    Object file        =  H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\ #
#                          Projects\zstack\Samples\ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍø£©\C #
#                          C2530DB\CoordinatorEB-Pro\Obj\MT_SYS.r51           #
#                                                                             #
#                                                                             #
###############################################################################

H:\zigbeesrc\8.ÎÞÏß´«¸ÐÆ÷ÍøÂç£¨×Ô×éÍøÓëÊý¾Ý´«Êä£©\Components\mt\MT_SYS.c
      1          /***************************************************************************************************
      2            Filename:       MT_SYS.c
      3            Revised:        $Date: 2009-12-22 17:20:57 -0800 (Tue, 22 Dec 2009) $
      4            Revision:       $Revision: 21402 $
      5          
      6            Description:   MonitorTest
      7          
      8            Copyright 2007-2009 Texas Instruments Incorporated. All rights reserved.
      9          
     10            IMPORTANT: Your use of this Software is limited to those specific rights
     11            granted under the terms of a software license agreement between the user
     12            who downloaded the software, his/her employer (which must be your employer)
     13            and Texas Instruments Incorporated (the "License").  You may not use this
     14            Software unless you agree to abide by the terms of the License. The License
     15            limits your use, and you acknowledge, that the Software may not be modified,
     16            copied or distributed unless embedded on a Texas Instruments microcontroller
     17            or used solely and exclusively in conjunction with a Texas Instruments radio
     18            frequency transceiver, which is integrated into your product.  Other than for
     19            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     20            works of, modify, distribute, perform, display or sell this Software and/or
     21            its documentation for any purpose.
     22          
     23            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     24            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     25            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     26            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     27            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     28            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     29            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     30            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     31            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     32            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     33            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     34          
     35            Should you have any questions regarding your right to use this Software,
     36            contact Texas Instruments Incorporated at www.TI.com.
     37          
     38           ***************************************************************************************************/
     39          
     40          /***************************************************************************************************
     41           * INCLUDES
     42           ***************************************************************************************************/
     43          #include "ZComDef.h"
     44          #include "MT.h"
     45          #include "MT_SYS.h"
     46          #include "MT_VERSION.h"
     47          #include "nwk_util.h"
     48          #include "OSAL.h"
     49          #include "OSAL_NV.h"
     50          #include "Onboard.h"  /* This is here because RAM read/write macros need it */

   \                                 In  segment SFR_AN, at 0x9d
   \   unsigned char volatile __sfr SLEEPSTA
   \                     SLEEPSTA:
   \   000000                DS 1
     51          #include "hal_adc.h"
     52          #include "ZGlobals.h"
     53          
     54          /***************************************************************************************************
     55           * MACROS
     56           ***************************************************************************************************/
     57          
     58          #define MT_SYS_DEVICE_INFO_RESPONSE_LEN 14
     59          #define MT_NV_ITEM_MAX_LENGTH           250
     60          
     61          #if !defined HAL_GPIO || !HAL_GPIO
     62          #define GPIO_DIR_IN(IDX)
     63          #define GPIO_DIR_OUT(IDX)
     64          #define GPIO_TRI(IDX)
     65          #define GPIO_PULL_UP(IDX)
     66          #define GPIO_PULL_DN(IDX)
     67          #define GPIO_SET(IDX)
     68          #define GPIO_CLR(IDX)
     69          #define GPIO_TOG(IDX)
     70          #define GPIO_GET(IDX) 0
     71          #define GPIO_HiD_SET() (val = 0)
     72          #define GPIO_HiD_CLR() (val = 0)
     73          #endif
     74          
     75          /***************************************************************************************************
     76           * CONSTANT
     77           ***************************************************************************************************/

   \                                 In  segment XDATA_ROM_C, align 1
     78          const uint16 MT_SysOsalEventId [] = {
   \                     MT_SysOsalEventId:
   \   000000   0008         DW 2048
   \   000002   0004         DW 1024
   \   000004   0002         DW 512
   \   000006   0001         DW 256
     79                                                MT_SYS_OSAL_EVENT_0,
     80                                                MT_SYS_OSAL_EVENT_1,
     81                                                MT_SYS_OSAL_EVENT_2,
     82                                                MT_SYS_OSAL_EVENT_3
     83                                              };
     84          
     85          typedef enum {
     86            GPIO_DIR,
     87            GPIO_TRI,
     88            GPIO_SET,
     89            GPIO_CLR,
     90            GPIO_TOG,
     91            GPIO_GET,
     92            GPIO_HiD = 0x12
     93          } GPIO_Op_t;
     94          
     95          #define GPIO_MASK  0x33
     96          
     97          /***************************************************************************************************
     98           * EXTERNAL FUNCTIONS
     99           ***************************************************************************************************/
    100          extern uint16 HalAdcReadVoltage(void);
    101          extern uint16 HalAdcReadTemperature(void);
    102          
    103          /***************************************************************************************************
    104           * LOCAL FUNCTIONS
    105           ***************************************************************************************************/
    106          #if defined (MT_SYS_FUNC)
    107          void MT_SysReset(uint8 *pBuf);
    108          void MT_SysPing(void);
    109          void MT_SysVersion(void);
    110          void MT_SysSetExtAddr(uint8 *pBuf);
    111          void MT_SysGetExtAddr(void);
    112          void MT_SysOsalNVWrite(uint8 *pBuf);
    113          void MT_SysOsalNVRead(uint8 *pBuf);
    114          void MT_SysOsalStartTimer(uint8 *pBuf);
    115          void MT_SysOsalStopTimer(uint8 *pBuf);
    116          void MT_SysRandom(void);
    117          void MT_SysAdcRead(uint8 *pBuf);
    118          void MT_SysGpio(uint8 *pBuf);
    119          void MT_SysStackTune(uint8 *pBuf);
    120          void MT_SysGetDeviceInfo(uint8 *pBuf);
    121          #endif /* MT_SYS_FUNC */
    122          
    123          #if defined (MT_SYS_FUNC)
    124          /***************************************************************************************************
    125           * @fn      MT_SysProcessing
    126           *
    127           * @brief   Process all the SYS commands that are issued by test tool
    128           *
    129           * @param   pBuf - pointer to the msg buffer
    130           *
    131           *          | LEN  | CMD0  | CMD1  |  DATA  |
    132           *          |  1   |   1   |   1   |  0-255 |
    133           *
    134           * @return  status
    135           ***************************************************************************************************/
    136          uint8 MT_SysCommandProcessing(uint8 *pBuf)
    137          {
    138            uint8 status = MT_RPC_SUCCESS;
    139          
    140            switch (pBuf[MT_RPC_POS_CMD1])
    141            {
    142              case MT_SYS_RESET_REQ:
    143                MT_SysReset(pBuf);
    144                break;
    145          
    146              case MT_SYS_PING:
    147                MT_SysPing();
    148                break;
    149          
    150              case MT_SYS_VERSION:
    151                MT_SysVersion();
    152                break;
    153          
    154              case MT_SYS_SET_EXTADDR:
    155                MT_SysSetExtAddr(pBuf);
    156                break;
    157          
    158              case MT_SYS_GET_EXTADDR:
    159                MT_SysGetExtAddr();
    160                break;
    161          
    162              case MT_SYS_OSAL_NV_READ:
    163                MT_SysOsalNVRead(pBuf);
    164                break;
    165          
    166              case MT_SYS_OSAL_NV_WRITE:
    167                MT_SysOsalNVWrite(pBuf);
    168                break;
    169          
    170              case MT_SYS_OSAL_START_TIMER:
    171                MT_SysOsalStartTimer(pBuf);
    172                break;
    173          
    174              case MT_SYS_OSAL_STOP_TIMER:
    175                MT_SysOsalStopTimer(pBuf);
    176                break;
    177          
    178              case MT_SYS_RANDOM:
    179                MT_SysRandom();
    180                break;
    181          
    182              case MT_SYS_ADC_READ:
    183                MT_SysAdcRead(pBuf);
    184                break;
    185          
    186              case MT_SYS_GPIO:
    187                MT_SysGpio(pBuf);
    188                break;
    189          
    190              case MT_SYS_STACK_TUNE:
    191                MT_SysStackTune(pBuf);
    192                break;
    193          
    194              case MT_SYS_RESET_IND:
    195                //TBD
    196                break;
    197          
    198              default:
    199                status = MT_RPC_ERR_COMMAND_ID;
    200                break;
    201            }
    202          
    203            return status;
    204          }
    205          
    206          /***************************************************************************************************
    207           * @fn      MT_SysReset
    208           *
    209           * @brief   Reset/reprogram the device.
    210           * @param   typID: 0=reset, 1=serial bootloader
    211           *
    212           * @return  None
    213           ***************************************************************************************************/
    214          void MT_SysReset(uint8 *pBuf)
    215          {
    216            (void)pBuf;  // Intentionally unreferenced parameter
    217            SystemReset();  /* Restart this program */
    218          }
    219          
    220          /***************************************************************************************************
    221           * @fn      MT_SysPing
    222           *
    223           * @brief   Process the Ping command
    224           *
    225           * @param   None
    226           *
    227           * @return  None
    228           ***************************************************************************************************/
    229          void MT_SysPing(void)
    230          {
    231            uint16 tmp16;
    232            uint8 retArray[2];
    233          
    234            /* Build Capabilities */
    235            tmp16 = MT_CAP_SYS | MT_CAP_MAC | MT_CAP_NWK | MT_CAP_AF | MT_CAP_ZDO|
    236                    MT_CAP_SAPI | MT_CAP_UTIL | MT_CAP_DEBUG | MT_CAP_APP | MT_CAP_ZOAD;
    237          
    238            /* Convert to high byte first into temp buffer */
    239            retArray[0] = LO_UINT16( tmp16 );
    240            retArray[1] = HI_UINT16( tmp16 );
    241          
    242            /* Build and send back the response */
    243            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_SYS), MT_SYS_PING,
    244                                          sizeof (tmp16), retArray );
    245          }
    246          
    247          /***************************************************************************************************
    248           * @fn      MT_SysVersion
    249           *
    250           * @brief   Process the Version command
    251           *
    252           * @param   None
    253           *
    254           * @return  None
    255           ***************************************************************************************************/
    256          void MT_SysVersion(void)
    257          {
    258            byte *verStr = (byte *)MTVersionString;
    259            uint8 respLen = sizeof(MTVersionString);
    260          
    261            /* Build and send back the response */
    262            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_SYS), MT_SYS_VERSION,
    263                                         respLen, verStr);
    264          }
    265          
    266          /***************************************************************************************************
    267           * @fn      MT_SysSetExtAddr
    268           *
    269           * @brief   Set the Extended Address
    270           *
    271           * @param   pBuf
    272           *
    273           * @return  None
    274           ***************************************************************************************************/
    275          void MT_SysSetExtAddr(uint8 *pBuf)
    276          {
    277            uint8 retValue = ZFailure;
    278            uint8 cmdId;
    279          
    280            /* parse header */
    281            cmdId = pBuf[MT_RPC_POS_CMD1];
    282            pBuf += MT_RPC_FRAME_HDR_SZ;
    283          
    284            if ( ZMacSetReq(ZMacExtAddr, pBuf) == ZMacSuccess )
    285            {
    286              retValue = osal_nv_write(ZCD_NV_EXTADDR, 0, Z_EXTADDR_LEN, pBuf);
    287            }
    288          
    289            /* Build and send back the response */
    290            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_SYS), cmdId, 1, &retValue);
    291          
    292          }
    293          
    294          /***************************************************************************************************
    295           * @fn      MT_SysGetExtAddr
    296           *
    297           * @brief   Get the Extended Address
    298           *
    299           * @param   None
    300           *
    301           * @return  None
    302           ***************************************************************************************************/
    303          void MT_SysGetExtAddr(void)
    304          {
    305            uint8 extAddr[Z_EXTADDR_LEN];
    306          
    307            ZMacGetReq( ZMacExtAddr, extAddr );
    308          
    309            /* Build and send back the response */
    310            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_SYS), MT_SYS_GET_EXTADDR,
    311                                         Z_EXTADDR_LEN, extAddr);
    312          }
    313          
    314          /***************************************************************************************************
    315           * @fn      MT_SysOsalNVRead
    316           *
    317           * @brief  Read a NV value
    318           *
    319           * @param  uint8 pBuf - pointer to the data
    320           *
    321           * @return  None
    322           ***************************************************************************************************/
    323          void MT_SysOsalNVRead(uint8 *pBuf)
    324          {
    325            uint16 nvId;
    326            uint8 nvItemLen=0, nvItemOffset=0;
    327            uint8 *pRetBuf=NULL;
    328            uint8 respLen, cmdId;
    329          
    330            /* parse header */
    331            cmdId = pBuf[MT_RPC_POS_CMD1];
    332            pBuf += MT_RPC_FRAME_HDR_SZ;
    333          
    334            /* Get the ID */
    335            nvId = BUILD_UINT16(pBuf[0], pBuf[1]);
    336            pBuf += sizeof(uint16);
    337          
    338            /* Calculate the offset */
    339            nvItemOffset = *pBuf;
    340          
    341            nvItemLen = osal_nv_item_len(nvId);
    342          
    343            /* Return only 250 bytes max */
    344            if (nvItemLen > MT_NV_ITEM_MAX_LENGTH)
    345            {
    346              nvItemLen = MT_NV_ITEM_MAX_LENGTH;
    347            }
    348          
    349            if ((nvItemLen > 0) && ((nvItemLen - nvItemOffset) > 0))
    350            {
    351              respLen = nvItemLen - nvItemOffset + 2;
    352            }
    353            else
    354            {
    355              respLen = 2;
    356            }
    357          
    358            pRetBuf = osal_mem_alloc(respLen);
    359          
    360            if (pRetBuf != NULL)
    361            {
    362              osal_memset(pRetBuf, 0, respLen);
    363          
    364              /* Default to ZFailure */
    365              pRetBuf[0] = ZFailure;
    366          
    367              if (respLen > 2)
    368              {
    369                if (((osal_nv_read( nvId, (uint16)nvItemOffset, (uint16)nvItemLen, &pRetBuf[2])) == ZSUCCESS) && (respLen > 2))
    370                {
    371                  pRetBuf[0] = ZSuccess;
    372                }
    373                pRetBuf[1] = nvItemLen - nvItemOffset;
    374              }
    375              else
    376              {
    377                pRetBuf[1] = 0;
    378              }
    379          
    380              /* Build and send back the response */
    381              MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_SYS), cmdId, respLen, pRetBuf );
    382          
    383              osal_mem_free(pRetBuf);
    384            }
    385          
    386          
    387          }
    388          
    389          /***************************************************************************************************
    390           * @fn      MT_SysOsalNVWrite
    391           *
    392           * @brief
    393           *
    394           * @param   uint8 pData - pointer to the data
    395           *
    396           * @return  None
    397           ***************************************************************************************************/
    398          void MT_SysOsalNVWrite(uint8 *pBuf)
    399          {
    400            uint16 nvId;
    401            uint8 nvItemLen=0, nvItemOffset=0;
    402            uint8 rtrn, cmd;
    403          
    404            /* parse header */
    405            cmd = pBuf[MT_RPC_POS_CMD1];
    406            pBuf += MT_RPC_FRAME_HDR_SZ;
    407          
    408            /* Get the ID */
    409            nvId = BUILD_UINT16(pBuf[0], pBuf[1]);
    410            pBuf += sizeof(uint16);
    411          
    412            /* Calculate the offset */
    413            nvItemOffset = *pBuf++;
    414          
    415            /* Calculate the length */
    416            nvItemLen = *pBuf++;
    417          
    418            /* Default to ZFailure */
    419            rtrn = ZFailure;
    420          
    421            /* Set the Z-Globals value of this NV item. */
    422            zgSetItem( nvId, (uint16)nvItemLen, pBuf );
    423          
    424            if ((osal_nv_write(nvId, (uint16)nvItemOffset, (uint16)nvItemLen, pBuf)) == ZSUCCESS)
    425            {
    426              if (nvId == ZCD_NV_EXTADDR)
    427              {
    428                rtrn = ZMacSetReq(ZMacExtAddr, pBuf);
    429              }
    430              else
    431              {
    432                rtrn = ZSuccess;
    433              }
    434            }
    435          
    436            /* Build and send back the response */
    437            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_SYS), cmd, 1, &rtrn);
    438          }
    439          
    440          /***************************************************************************************************
    441           * @fn      MT_SysOsalStartTimer
    442           *
    443           * @brief
    444           *
    445           * @param   uint8 pData - pointer to the data
    446           *
    447           * @return  None
    448           ***************************************************************************************************/
    449          void MT_SysOsalStartTimer(uint8 *pBuf)
    450          {
    451            uint16 eventId;
    452            uint8 retValue = ZFailure;
    453            uint8 cmdId;
    454          
    455            /* parse header */
    456            cmdId = pBuf[MT_RPC_POS_CMD1];
    457            pBuf += MT_RPC_FRAME_HDR_SZ;
    458          
    459            if (*pBuf <= 3)
    460            {
    461              eventId = (uint16) MT_SysOsalEventId[*pBuf];
    462              retValue = osal_start_timerEx(MT_TaskID, eventId, BUILD_UINT16(pBuf[1], pBuf[2]));
    463            }
    464            else
    465            {
    466              retValue = ZInvalidParameter;
    467            }
    468          
    469            /* Build and send back the response */
    470            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_SYS), cmdId, 1, &retValue);
    471          }
    472          
    473          /***************************************************************************************************
    474           * @fn      MT_SysOsalStopTimer
    475           *
    476           * @brief
    477           *
    478           * @param   uint8 pData - pointer to the data
    479           *
    480           * @return  None
    481           ***************************************************************************************************/
    482          void MT_SysOsalStopTimer(uint8 *pBuf)
    483          {
    484            uint16 eventId;
    485            uint8 retValue = ZFailure;
    486            uint8 cmdId;
    487          
    488            /* parse header */
    489            cmdId = pBuf[MT_RPC_POS_CMD1];
    490            pBuf += MT_RPC_FRAME_HDR_SZ;
    491          
    492            if (*pBuf <= 3)
    493            {
    494              eventId = (uint16) MT_SysOsalEventId[*pBuf];
    495              retValue = osal_stop_timerEx(MT_TaskID, eventId);
    496            }
    497            else
    498            {
    499              retValue = ZInvalidParameter;
    500            }
    501          
    502            /* Build and send back the response */
    503            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_SYS), cmdId, 1, &retValue );
    504          }
    505          
    506          /***************************************************************************************************
    507           * @fn      MT_SysRandom
    508           *
    509           * @brief
    510           *
    511           * @param   uint8 pData - pointer to the data
    512           *
    513           * @return  None
    514           ***************************************************************************************************/
    515          void MT_SysRandom()
    516          {
    517            uint16 randValue = Onboard_rand();
    518            uint8 retArray[2];
    519          
    520            retArray[0] = LO_UINT16(randValue);
    521            retArray[1] = HI_UINT16(randValue);
    522          
    523            /* Build and send back the response */
    524            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_SYS), MT_SYS_RANDOM, 2, retArray );
    525          }
    526          
    527          /***************************************************************************************************
    528           * @fn      MT_SysAdcRead
    529           *
    530           * @brief   Reading ADC value, temperature sensor and voltage
    531           *
    532           * @param   uint8 pData - pointer to the data
    533           *
    534           * @return  None
    535           ***************************************************************************************************/
    536          void MT_SysAdcRead(uint8 *pBuf)
    537          {
    538            uint8 channel, resolution;
    539            uint16 tempValue;
    540            uint8 retArray[2];
    541            uint8 cmdId;
    542          
    543            /* parse header */
    544            cmdId = pBuf[MT_RPC_POS_CMD1];
    545            pBuf += MT_RPC_FRAME_HDR_SZ;
    546          
    547            /* Channel */
    548            channel = *pBuf++;
    549          
    550            /* Resolution */
    551            resolution = *pBuf++;
    552          
    553            /* Voltage reading */
    554            switch (channel)
    555            {
    556              /* Analog input channel */
    557              case HAL_ADC_CHANNEL_0:
    558              case HAL_ADC_CHANNEL_1:
    559              case HAL_ADC_CHANNEL_2:
    560              case HAL_ADC_CHANNEL_3:
    561              case HAL_ADC_CHANNEL_4:
    562              case HAL_ADC_CHANNEL_5:
    563              case HAL_ADC_CHANNEL_6:
    564              case HAL_ADC_CHANNEL_7:
    565                tempValue = HalAdcRead(channel, resolution);
    566                break;
    567          
    568              /* Temperature sensor */
    569              case(HAL_ADC_CHANNEL_TEMP):
    570                tempValue = HalAdcRead(HAL_ADC_CHANNEL_TEMP, HAL_ADC_RESOLUTION_14);
    571                break;
    572          
    573              /* Voltage reading */
    574              case(HAL_ADC_CHANNEL_VDD):
    575                tempValue = HalAdcRead(HAL_ADC_CHANNEL_VDD, HAL_ADC_RESOLUTION_14);
    576                break;
    577          
    578              /* Undefined channels */
    579              default:
    580                tempValue = 0x00;
    581                break;
    582            }
    583          
    584            retArray[0] = LO_UINT16(tempValue);
    585            retArray[1] = HI_UINT16(tempValue);
    586          
    587            /* Build and send back the response */
    588            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_SYS), cmdId, 2, retArray);
    589          }
    590          
    591          /**************************************************************************************************
    592           * @fn      MT_SysGpio
    593           *
    594           * @brief   ZAccel RPC interface for controlling the available GPIO pins.
    595           *
    596           * @param   uint8 pData - Pointer to the data.
    597           *
    598           * @return  None
    599           *************************************************************************************************/
    600          void MT_SysGpio(uint8 *pBuf)
    601          {
    602            uint8 cmd, val;
    603            GPIO_Op_t op;
    604          
    605            cmd = pBuf[MT_RPC_POS_CMD1];
    606            pBuf += MT_RPC_FRAME_HDR_SZ;
    607          
    608            op = (GPIO_Op_t)(*pBuf++);
    609            val = *pBuf & GPIO_MASK;
    610          
    611            switch (op)
    612            {
    613              case GPIO_DIR:
    614                if (val & BV(0)) {GPIO_DIR_OUT(0);} else {GPIO_DIR_IN(0);}
    615                if (val & BV(1)) {GPIO_DIR_OUT(1);} else {GPIO_DIR_IN(1);}
    616                if (val & BV(2)) {GPIO_DIR_OUT(2);} else {GPIO_DIR_IN(2);}
    617                if (val & BV(3)) {GPIO_DIR_OUT(3);} else {GPIO_DIR_IN(3);}
    618                break;
    619          
    620              case GPIO_TRI:
    621                if(val & BV(0)) {GPIO_TRI(0);} else if(val & BV(4)) {GPIO_PULL_DN(0);} else {GPIO_PULL_UP(0);}
    622                if(val & BV(1)) {GPIO_TRI(1);} else if(val & BV(5)) {GPIO_PULL_DN(1);} else {GPIO_PULL_UP(1);}
    623                if(val & BV(2)) {GPIO_TRI(2);} else if(val & BV(6)) {GPIO_PULL_DN(2);} else {GPIO_PULL_UP(2);}
    624                if(val & BV(3)) {GPIO_TRI(3);} else if(val & BV(7)) {GPIO_PULL_DN(3);} else {GPIO_PULL_UP(3);}
    625                break;
    626          
    627              case GPIO_SET:
    628                if (val & BV(0)) {GPIO_SET(0);}
    629                if (val & BV(1)) {GPIO_SET(1);}
    630                if (val & BV(2)) {GPIO_SET(2);}
    631                if (val & BV(3)) {GPIO_SET(3);}
    632                break;
    633          
    634              case GPIO_CLR:
    635                if (val & BV(0)) {GPIO_CLR(0);}
    636                if (val & BV(1)) {GPIO_CLR(1);}
    637                if (val & BV(2)) {GPIO_CLR(2);}
    638                if (val & BV(3)) {GPIO_CLR(3);}
    639                break;
    640          
    641              case GPIO_TOG:
    642                if (val & BV(0)) {GPIO_TOG(0);}
    643                if (val & BV(1)) {GPIO_TOG(1);}
    644                if (val & BV(2)) {GPIO_TOG(2);}
    645                if (val & BV(3)) {GPIO_TOG(3);}
    646                break;
    647          
    648              case GPIO_GET:
    649                break;
    650          
    651              case GPIO_HiD:
    652                (val) ? GPIO_HiD_SET() :  GPIO_HiD_CLR();
    653                break;
    654          
    655              default:
    656                break;
    657            }
    658          
    659            val  = (GPIO_GET(0)) ? BV(0) : 0;
    660            val |= (GPIO_GET(1)) ? BV(1) : 0;
    661            val |= (GPIO_GET(2)) ? BV(2) : 0;
    662            val |= (GPIO_GET(3)) ? BV(3) : 0;
    663          
    664            /* Build and send back the response */
    665            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_SYS), cmd, 1, &val);
    666          }
    667          
    668          /**************************************************************************************************
    669           * @fn      MT_SysStackTune
    670           *
    671           * @brief   ZAccel RPC interface for tuning the stack parameters to adjust performance
    672           *
    673           * @param   uint8 pData - Pointer to the data.
    674           *
    675           * @return  None
    676           *************************************************************************************************/
    677          void MT_SysStackTune(uint8 *pBuf)
    678          {
    679            uint8 cmd, rtrn;
    680          
    681            cmd = pBuf[MT_RPC_POS_CMD1];
    682            pBuf += MT_RPC_FRAME_HDR_SZ;
    683          
    684            switch (*pBuf++)
    685            {
    686            case STK_TX_PWR:
    687              rtrn = ZMacSetReq(ZMacPhyTransmitPower, pBuf);
    688              break;
    689          
    690            case STK_RX_ON_IDLE:
    691              if ((*pBuf != TRUE) && (*pBuf != FALSE))
    692              {
    693                (void)ZMacGetReq(ZMacRxOnIdle, &rtrn);
    694              }
    695              else
    696              {
    697                rtrn = ZMacSetReq(ZMacRxOnIdle, pBuf);
    698              }
    699              break;
    700          
    701            default:
    702              rtrn = ZInvalidParameter;
    703              break;
    704            }
    705          
    706            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_SYS), cmd, 1, &rtrn);
    707          }
    708          #endif /* MT_SYS_FUNC */
    709          
    710          /***************************************************************************************************
    711           * SUPPORT
    712           ***************************************************************************************************/
    713          
    714          /***************************************************************************************************
    715           * @fn      MT_SysResetInd()
    716           *
    717           * @brief   Sends a ZTOOL "reset response" message.
    718           *
    719           * @param   None
    720           *
    721           * @return  None
    722           *
    723           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    724          void MT_SysResetInd(void)
   \                     MT_SysResetInd:
    725          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 6
   \   000005   74FA         MOV     A,#-0x6
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    726            uint8 retArray[6];
    727          
    728            retArray[0] = ResetReason();   /* Reason */
   \   00000A   E59D         MOV     A,0x9d
   \   00000C   13           RRC     A
   \   00000D   13           RRC     A
   \   00000E   13           RRC     A
   \   00000F   541F         ANL     A,#0x1f
   \   000011   5403         ANL     A,#0x3
   \   000013   85..82       MOV     DPL,?XSP + 0
   \   000016   85..83       MOV     DPH,?XSP + 1
   \   000019   F0           MOVX    @DPTR,A
    729            osal_memcpy( &retArray[1], MTVersionString, 5 );   /* Revision info */
   \   00001A                ; Setup parameters for call to function osal_memcpy
   \   00001A   75....       MOV     ?V0 + 0,#MTVersionString & 0xff
   \   00001D   75....       MOV     ?V0 + 1,#(MTVersionString >> 8) & 0xff
   \   000020   75..00       MOV     ?V0 + 2,#0x0
   \   000023   78..         MOV     R0,#?V0 + 0
   \   000025   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000028   7C05         MOV     R4,#0x5
   \   00002A   7D00         MOV     R5,#0x0
   \   00002C   7404         MOV     A,#0x4
   \   00002E   12....       LCALL   ?XSTACK_DISP0_8
   \   000031   AA82         MOV     R2,DPL
   \   000033   AB83         MOV     R3,DPH
   \   000035   12....       LCALL   ??osal_memcpy?relay
   \   000038   7403         MOV     A,#0x3
   \   00003A   12....       LCALL   ?DEALLOC_XSTACK8
    730          
    731            /* Send out Reset Response message */
    732            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_SYS), MT_SYS_RESET_IND,
    733                                          sizeof(retArray), retArray);
   \   00003D                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   00003D   85..82       MOV     DPL,?XSP + 0
   \   000040   85..83       MOV     DPH,?XSP + 1
   \   000043   AC82         MOV     R4,DPL
   \   000045   AD83         MOV     R5,DPH
   \   000047   7B06         MOV     R3,#0x6
   \   000049   7A80         MOV     R2,#-0x80
   \   00004B   7941         MOV     R1,#0x41
   \   00004D   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    734          }
   \   000050   7406         MOV     A,#0x6
   \   000052   12....       LCALL   ?DEALLOC_XSTACK8
   \   000055   7F03         MOV     R7,#0x3
   \   000057   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   00005A                REQUIRE SLEEPSTA
    735          
    736          /***************************************************************************************************
    737           * @fn      MT_SysOsalTimerExpired()
    738           *
    739           * @brief   Sends a SYS Osal Timer Expired
    740           *
    741           * @param   None
    742           *
    743           * @return  None
    744           *
    745           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    746          void MT_SysOsalTimerExpired(uint8 Id)
   \                     MT_SysOsalTimerExpired:
    747          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
    748            uint8 retValue;
    749            retValue = Id;
   \   00000B   85..82       MOV     DPL,?XSP + 0
   \   00000E   85..83       MOV     DPH,?XSP + 1
   \   000011   F0           MOVX    @DPTR,A
    750            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_SYS), MT_SYS_OSAL_TIMER_EXPIRED, 1, &retValue);
   \   000012                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000012   AC82         MOV     R4,DPL
   \   000014   AD83         MOV     R5,DPH
   \   000016   7B01         MOV     R3,#0x1
   \   000018   7A81         MOV     R2,#-0x7f
   \   00001A   7941         MOV     R1,#0x41
   \   00001C   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    751          }
   \   00001F   7401         MOV     A,#0x1
   \   000021   12....       LCALL   ?DEALLOC_XSTACK8
   \   000024   7F01         MOV     R7,#0x1
   \   000026   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_SysResetInd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_SysResetInd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_SysOsalTimerExpired?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_SysOsalTimerExpired
    752          
    753          /***************************************************************************************************
    754           ***************************************************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     MT_SysOsalTimerExpired             1      0     10
       -> MT_BuildAndSendZToolResponse
                                        0      0     20
     MT_SysResetInd                     1      0     20
       -> osal_memcpy                   0      0     40
       -> MT_BuildAndSendZToolResponse
                                        0      0     34


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     SLEEPSTA                          1
     MT_SysOsalEventId                 8
     MT_SysResetInd                   90
     MT_SysOsalTimerExpired           41
     ??MT_SysResetInd?relay            6
     ??MT_SysOsalTimerExpired?relay    6

 
 131 bytes in segment BANKED_CODE
  12 bytes in segment BANK_RELAYS
   1 byte  in segment SFR_AN
   8 bytes in segment XDATA_ROM_C
 
 143 bytes of CODE  memory
   8 bytes of CONST memory
   0 bytes of DATA  memory (+ 1 byte shared)

Errors: none
Warnings: none
